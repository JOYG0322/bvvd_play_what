<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ˜äº‰é›·éœ†æ¨¡å¼æŠ½å–å·¥å…·</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            /* ç™½å¤©ä¸»é¢˜å˜é‡ */
            --day-bg-color: #f0f4f8;
            --day-container-bg: #ffffff;
            --day-text-color: #2c3e50;
            --day-primary-color: #3498db;
            --day-secondary-color: #2c3e50;
            --day-border-color: #dbe2e8;
            --day-button-bg: #3498db;
            --day-button-text: #ffffff;
            --day-result-bg: #e8f4fc;
            --day-history-bg: #f8f9fa;
            --day-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --day-mode-bg: #e8f4fc;
            
            /* é»‘å¤œä¸»é¢˜å˜é‡ */
            --night-bg-color: #1a2a1a;
            --night-container-bg: #213421;
            --night-text-color: #e0e0c0;
            --night-primary-color: #c8b070;
            --night-secondary-color: #e0e0c0;
            --night-border-color: #5a7d5a;
            --night-button-bg: #5a7d5a;
            --night-button-text: #e0e0c0;
            --night-result-bg: #2a3c2a;
            --night-history-bg: #223322;
            --night-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            --night-mode-bg: #2a3c2a;
            
            /* å½“å‰ä¸»é¢˜å˜é‡ï¼ˆé»˜è®¤ç™½å¤©ï¼‰ */
            --bg-color: var(--day-bg-color);
            --container-bg: var(--day-container-bg);
            --text-color: var(--day-text-color);
            --primary-color: var(--day-primary-color);
            --secondary-color: var(--day-secondary-color);
            --border-color: var(--day-border-color);
            --button-bg: var(--day-button-bg);
            --button-text: var(--day-button-text);
            --result-bg: var(--day-result-bg);
            --history-bg: var(--day-history-bg);
            --shadow: var(--day-shadow);
            --mode-bg: var(--day-mode-bg);
        }

        body.night-theme {
            --bg-color: var(--night-bg-color);
            --container-bg: var(--night-container-bg);
            --text-color: var(--night-text-color);
            --primary-color: var(--night-primary-color);
            --secondary-color: var(--night-secondary-color);
            --border-color: var(--night-border-color);
            --button-bg: var(--night-button-bg);
            --button-text: var(--night-button-text);
            --result-bg: var(--night-result-bg);
            --history-bg: var(--night-history-bg);
            --shadow: var(--night-shadow);
            --mode-bg: var(--night-mode-bg);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            padding: 15px;
            line-height: 1.6;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 10px;
        }
        
        header {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--container-bg);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
        }
        
        .header-title {
            text-align: center;
        }
        
        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .theme-toggle, .lang-select {
            padding: 12px 15px;
            background: var(--button-bg);
            color: var(--button-text);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            flex: 1;
            min-width: 140px;
            text-align: center;
            font-size: 16px;
        }
        
        .lang-select {
            background: var(--container-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            padding: 12px 10px;
        }
        
        h1 {
            color: var(--primary-color);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .modes-section, .result-section {
            width: 100%;
            background: var(--container-bg);
            padding: 20px 15px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
        }
        
        .section-title {
            color: var(--primary-color);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--border-color);
            text-align: center;
            font-size: 1.4rem;
        }
        
        .mode-item {
            margin-bottom: 12px;
            padding: 12px 15px;
            background: var(--mode-bg);
            border-radius: 10px;
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
        }
        
        .mode-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .mode-item input {
            margin-right: 15px;
            transform: scale(1.4);
            accent-color: var(--primary-color);
        }
        
        .mode-item label {
            font-size: 1.1rem;
            color: var(--text-color);
            cursor: pointer;
            flex: 1;
            padding: 5px 0;
        }
        
        .buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
        }
        
        button {
            padding: 16px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--button-bg);
            color: var(--button-text);
            min-height: 55px;
        }
        
        button:active {
            transform: scale(0.98);
        }
        
        #draw-button {
            background: var(--primary-color);
            color: var(--container-bg);
            font-size: 1.2rem;
            margin-top: 10px;
        }
        
        .result-display {
            text-align: center;
            padding: 25px 15px;
            margin: 15px 0;
            background: var(--result-bg);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .result-text {
            font-size: 1.8rem;
            color: var(--primary-color);
            margin: 10px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            word-break: break-word;
            line-height: 1.3;
        }
        
        .result-time {
            color: var(--secondary-color);
            font-size: 0.95rem;
            margin-top: 12px;
        }
        
        .history-section {
            background: var(--container-bg);
            padding: 20px 15px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }
        
        .history-list {
            max-height: 250px;
            overflow-y: auto;
            padding: 10px;
            background: var(--history-bg);
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }
        
        .history-item {
            padding: 12px 10px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.95rem;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .history-mode {
            font-weight: bold;
            color: var(--primary-color);
            flex: 1;
        }
        
        .history-time {
            color: var(--secondary-color);
            font-size: 0.85rem;
            text-align: right;
            margin-left: 10px;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            color: var(--secondary-color);
            font-size: 0.85rem;
            padding: 0 10px;
        }
        
        /* ç§»åŠ¨è®¾å¤‡ä¼˜åŒ– */
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 5px;
            }
            
            header {
                padding: 15px 10px;
            }
            
            h1 {
                font-size: 1.6rem;
            }
            
            .theme-toggle, .lang-select {
                min-width: 120px;
                font-size: 15px;
                padding: 10px 8px;
            }
            
            .modes-section, .result-section, .history-section {
                padding: 15px 10px;
            }
            
            .mode-item {
                padding: 10px 12px;
            }
            
            .mode-item label {
                font-size: 1rem;
            }
            
            .result-text {
                font-size: 1.6rem;
            }
            
            button {
                padding: 14px;
                font-size: 1rem;
                min-height: 50px;
            }
            
            #draw-button {
                font-size: 1.1rem;
            }
            
            .history-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .history-time {
                margin-left: 0;
                align-self: flex-end;
            }
        }
        
        @media (min-width: 768px) {
            .container {
                max-width: 90%;
            }
            
            .main-content {
                flex-direction: row;
            }
            
            .modes-section, .result-section {
                flex: 1;
            }
            
            .buttons {
                flex-direction: row;
            }
            
            header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
            
            .header-title {
                text-align: left;
                flex: 1;
            }
            
            .header-controls {
                flex-wrap: nowrap;
                justify-content: flex-end;
            }
        }
        
        @media (min-width: 1024px) {
            .container {
                max-width: 1000px;
            }
        }
    </style>
</head>
<body class="light-theme">
    <div class="container">
        <header>
            <div class="header-title">
                <h1 id="title">æˆ˜äº‰é›·éœ†æ¨¡å¼æŠ½å–å·¥å…·</h1>
            </div>
            <div class="header-controls">
                <button class="theme-toggle" id="theme-toggle">ğŸŒ™ åˆ‡æ¢åˆ°é»‘å¤œæ¨¡å¼</button>
                <select class="lang-select" id="lang-select">
                    <option value="zh">ä¸­æ–‡</option>
                    <option value="en">English</option>
                    <option value="ru">Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
                </select>
            </div>
        </header>
        
        <div class="main-content">
            <div class="modes-section">
                <h2 class="section-title" id="select-title">é€‰æ‹©æ¨¡å¼</h2>
                <div class="mode-item">
                    <input type="checkbox" id="ground-ab" checked>
                    <label for="ground-ab" id="label-ground-ab">é™†æˆ˜è¡—æœº</label>
                </div>
                <div class="mode-item">
                    <input type="checkbox" id="ground-rb" checked>
                    <label for="ground-rb" id="label-ground-rb">é™†æˆ˜å†å²</label>
                </div>
                <div class="mode-item">
                    <input type="checkbox" id="ground-sb">
                    <label for="ground-sb" id="label-ground-sb">é™†æˆ˜å…¨çœŸ</label>
                </div>
                <div class="mode-item">
                    <input type="checkbox" id="air-ab" checked>
                    <label for="air-ab" id="label-air-ab">ç©ºæˆ˜è¡—æœº</label>
                </div>
                <div class="mode-item">
                    <input type="checkbox" id="air-rb" checked>
                    <label for="air-rb" id="label-air-rb">ç©ºæˆ˜å†å²</label>
                </div>
                
                <div class="buttons">
                    <button id="select-all">å…¨é€‰</button>
                    <button id="select-none">å…¨ä¸é€‰</button>
                </div>
                <div class="buttons">
                    <button id="draw-button">æŠ½å–æ¨¡å¼</button>
                </div>
            </div>
            
            <div class="result-section">
                <h2 class="section-title" id="result-title">æŠ½å–ç»“æœ</h2>
                <div class="result-display">
                    <p id="click-to-draw">ç‚¹å‡»æŠ½å–æŒ‰é’®å¼€å§‹</p>
                    <div class="result-text" id="result">-</div>
                    <div class="result-time" id="result-time"></div>
                </div>
            </div>
        </div>
        
        <div class="history-section">
            <h2 class="section-title" id="history-title">æŠ½å–å†å²</h2>
            <div class="history-list" id="history-list">
                <!-- å†å²è®°å½•å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>
        
        <footer>
            <p id="footer-text">æˆ˜äº‰é›·éœ†æ¨¡å¼æŠ½å–å·¥å…· | éƒ¨ç½²äº Cloudflare Workers | æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // è¯­è¨€é…ç½®
            const translations = {
                'zh': {
                    'title': 'æˆ˜äº‰é›·éœ†æ¨¡å¼æŠ½å–å·¥å…·',
                    'select-title': 'é€‰æ‹©æ¨¡å¼',
                    'label-ground-ab': 'é™†æˆ˜è¡—æœº',
                    'label-ground-rb': 'é™†æˆ˜å†å²',
                    'label-ground-sb': 'é™†æˆ˜å…¨çœŸ',
                    'label-air-ab': 'ç©ºæˆ˜è¡—æœº',
                    'label-air-rb': 'ç©ºæˆ˜å†å²',
                    'select-all': 'å…¨é€‰',
                    'select-none': 'å…¨ä¸é€‰',
                    'draw-button': 'æŠ½å–æ¨¡å¼',
                    'result-title': 'æŠ½å–ç»“æœ',
                    'click-to-draw': 'ç‚¹å‡»æŠ½å–æŒ‰é’®å¼€å§‹',
                    'history-title': 'æŠ½å–å†å²',
                    'footer-text': 'æˆ˜äº‰é›·éœ†æ¨¡å¼æŠ½å–å·¥å…· | éƒ¨ç½²äº Cloudflare Workers | æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­',
                    'theme-day': 'â˜€ï¸ åˆ‡æ¢åˆ°ç™½å¤©æ¨¡å¼',
                    'theme-night': 'ğŸŒ™ åˆ‡æ¢åˆ°é»‘å¤œæ¨¡å¼',
                    'no-history': 'æš‚æ— å†å²è®°å½•',
                    'no-selection': 'è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæ¨¡å¼'
                },
                'en': {
                    'title': 'War Thunder Mode Selector',
                    'select-title': 'Select Modes',
                    'label-ground-ab': 'Ground AB',
                    'label-ground-rb': 'Ground RB',
                    'label-ground-sb': 'Ground SB',
                    'label-air-ab': 'Air AB',
                    'label-air-rb': 'Air RB',
                    'select-all': 'Select All',
                    'select-none': 'Select None',
                    'draw-button': 'Draw Mode',
                    'result-title': 'Result',
                    'click-to-draw': 'Click draw button to start',
                    'history-title': 'Draw History',
                    'footer-text': 'War Thunder Mode Selector | Deployed on Cloudflare Workers | Data stored locally',
                    'theme-day': 'â˜€ï¸ Switch to Day Mode',
                    'theme-night': 'ğŸŒ™ Switch to Night Mode',
                    'no-history': 'No history yet',
                    'no-selection': 'Please select at least one mode'
                },
                'ru': {
                    'title': 'Ğ’Ñ‹Ğ±Ğ¾Ñ€ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ° War Thunder',
                    'select-title': 'Ğ’Ñ‹Ğ±Ğ¾Ñ€ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ¾Ğ²',
                    'label-ground-ab': 'ĞĞ°Ğ·ĞµĞ¼Ğ½Ñ‹Ğµ AB',
                    'label-ground-rb': 'ĞĞ°Ğ·ĞµĞ¼Ğ½Ñ‹Ğµ RB',
                    'label-ground-sb': 'ĞĞ°Ğ·ĞµĞ¼Ğ½Ñ‹Ğµ SB',
                    'label-air-ab': 'ĞĞ²Ğ¸Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ AB',
                    'label-air-rb': 'ĞĞ²Ğ¸Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ RB',
                    'select-all': 'Ğ’Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ²ÑĞµ',
                    'select-none': 'Ğ¡Ğ½ÑÑ‚ÑŒ Ğ²ÑĞµ',
                    'draw-button': 'Ğ’Ñ‹Ğ±Ñ€Ğ°Ñ‚ÑŒ Ñ€ĞµĞ¶Ğ¸Ğ¼',
                    'result-title': 'Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚',
                    'click-to-draw': 'ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ´Ğ»Ñ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ°',
                    'history-title': 'Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ¾Ğ²',
                    'footer-text': 'Ğ’Ñ‹Ğ±Ğ¾Ñ€ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ° War Thunder | Ğ Ğ°Ğ·Ğ¼ĞµÑ‰ĞµĞ½Ğ¾ Ğ½Ğ° Cloudflare Workers | Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑÑ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ğ¾',
                    'theme-day': 'â˜€ï¸ ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ½Ğ° Ğ´Ğ½ĞµĞ²Ğ½Ğ¾Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼',
                    'theme-night': 'ğŸŒ™ ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ Ğ½Ğ° Ğ½Ğ¾Ñ‡Ğ½Ğ¾Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼',
                    'no-history': 'Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¿ÑƒÑÑ‚Ğ°',
                    'no-selection': 'ĞŸĞ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ°, Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ…Ğ¾Ñ‚Ñ Ğ±Ñ‹ Ğ¾Ğ´Ğ¸Ğ½ Ñ€ĞµĞ¶Ğ¸Ğ¼'
                }
            };
            
            // æ¨¡å¼æ•°æ®
            const modes = {
                'ground-ab': {
                    'zh': 'é™†æˆ˜è¡—æœº',
                    'en': 'Ground AB',
                    'ru': 'ĞĞ°Ğ·ĞµĞ¼Ğ½Ñ‹Ğµ AB'
                },
                'ground-rb': {
                    'zh': 'é™†æˆ˜å†å²',
                    'en': 'Ground RB',
                    'ru': 'ĞĞ°Ğ·ĞµĞ¼Ğ½Ñ‹Ğµ RB'
                },
                'ground-sb': {
                    'zh': 'é™†æˆ˜å…¨çœŸ',
                    'en': 'Ground SB',
                    'ru': 'ĞĞ°Ğ·ĞµĞ¼Ğ½Ñ‹Ğµ SB'
                },
                'air-ab': {
                    'zh': 'ç©ºæˆ˜è¡—æœº',
                    'en': 'Air AB',
                    'ru': 'ĞĞ²Ğ¸Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ AB'
                },
                'air-rb': {
                    'zh': 'ç©ºæˆ˜å†å²',
                    'en': 'Air RB',
                    'ru': 'ĞĞ²Ğ¸Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ RB'
                }
            };
            
            // è·å–DOMå…ƒç´ 
            const themeToggle = document.getElementById('theme-toggle');
            const langSelect = document.getElementById('lang-select');
            const drawButton = document.getElementById('draw-button');
            const resultElement = document.getElementById('result');
            const resultTimeElement = document.getElementById('result-time');
            const historyListElement = document.getElementById('history-list');
            const selectAllButton = document.getElementById('select-all');
            const selectNoneButton = document.getElementById('select-none');
            
            // åˆå§‹åŒ–è®¾ç½®
            let currentTheme = localStorage.getItem('theme') || 'light';
            let currentLang = localStorage.getItem('language') || 'zh';
            let drawHistory = JSON.parse(localStorage.getItem('warThunderDrawHistory')) || [];
            
            // åº”ç”¨ä¿å­˜çš„è®¾ç½®
            applyTheme(currentTheme);
            applyLanguage(currentLang);
            langSelect.value = currentLang;
            updateHistoryDisplay();
            
            // ä¸»é¢˜åˆ‡æ¢äº‹ä»¶
            themeToggle.addEventListener('click', function() {
                currentTheme = currentTheme === 'light' ? 'night' : 'light';
                applyTheme(currentTheme);
                localStorage.setItem('theme', currentTheme);
            });
            
            // è¯­è¨€åˆ‡æ¢äº‹ä»¶
            langSelect.addEventListener('change', function() {
                currentLang = langSelect.value;
                applyLanguage(currentLang);
                localStorage.setItem('language', currentLang);
                updateHistoryDisplay();
            });
            
            // åº”ç”¨ä¸»é¢˜
            function applyTheme(theme) {
                if (theme === 'night') {
                    document.body.classList.add('night-theme');
                    themeToggle.textContent = translations[currentLang]['theme-day'];
                } else {
                    document.body.classList.remove('night-theme');
                    themeToggle.textContent = translations[currentLang]['theme-night'];
                }
            }
            
            // åº”ç”¨è¯­è¨€
            function applyLanguage(lang) {
                // æ›´æ–°ç•Œé¢æ–‡æœ¬
                document.getElementById('title').textContent = translations[lang]['title'];
                document.getElementById('select-title').textContent = translations[lang]['select-title'];
                document.getElementById('label-ground-ab').textContent = translations[lang]['label-ground-ab'];
                document.getElementById('label-ground-rb').textContent = translations[lang]['label-ground-rb'];
                document.getElementById('label-ground-sb').textContent = translations[lang]['label-ground-sb'];
                document.getElementById('label-air-ab').textContent = translations[lang]['label-air-ab'];
                document.getElementById('label-air-rb').textContent = translations[lang]['label-air-rb'];
                document.getElementById('select-all').textContent = translations[lang]['select-all'];
                document.getElementById('select-none').textContent = translations[lang]['select-none'];
                document.getElementById('draw-button').textContent = translations[lang]['draw-button'];
                document.getElementById('result-title').textContent = translations[lang]['result-title'];
                document.getElementById('click-to-draw').textContent = translations[lang]['click-to-draw'];
                document.getElementById('history-title').textContent = translations[lang]['history-title'];
                document.getElementById('footer-text').textContent = translations[lang]['footer-text'];
                
                // æ›´æ–°ä¸»é¢˜æŒ‰é’®æ–‡æœ¬
                themeToggle.textContent = currentTheme === 'light' ? 
                    translations[lang]['theme-night'] : translations[lang]['theme-day'];
                
                // æ›´æ–°ç»“æœå’Œå†å²è®°å½•
                if (resultElement.textContent !== '-' && resultElement.textContent !== translations[lang]['no-selection']) {
                    const currentModeId = findModeIdByText(resultElement.textContent, currentLang);
                    if (currentModeId) {
                        resultElement.textContent = modes[currentModeId][lang];
                    }
                }
            }
            
            // é€šè¿‡æ–‡æœ¬æŸ¥æ‰¾æ¨¡å¼ID
            function findModeIdByText(text, lang) {
                for (const id in modes) {
                    if (modes[id][lang] === text) {
                        return id;
                    }
                }
                return null;
            }
            
            // æŠ½å–æŒ‰é’®äº‹ä»¶
            drawButton.addEventListener('click', function() {
                // è·å–é€‰ä¸­çš„æ¨¡å¼
                const selectedModes = [];
                for (const id in modes) {
                    const checkbox = document.getElementById(id);
                    if (checkbox.checked) {
                        selectedModes.push(id);
                    }
                }
                
                // å¦‚æœæ²¡æœ‰é€‰æ‹©ä»»ä½•æ¨¡å¼ï¼Œæç¤ºç”¨æˆ·
                if (selectedModes.length === 0) {
                    resultElement.textContent = translations[currentLang]['no-selection'];
                    resultTimeElement.textContent = '';
                    return;
                }
                
                // éšæœºé€‰æ‹©ä¸€ä¸ªæ¨¡å¼
                const randomIndex = Math.floor(Math.random() * selectedModes.length);
                const selectedModeId = selectedModes[randomIndex];
                const selectedModeName = modes[selectedModeId][currentLang];
                
                // æ˜¾ç¤ºç»“æœ
                resultElement.textContent = selectedModeName;
                
                // è®°å½•æ—¶é—´
                const now = new Date();
                const timeString = now.toLocaleDateString() + ' ' + now.toLocaleTimeString();
                resultTimeElement.textContent = translations[currentLang]['result-title'] + ': ' + timeString;
                
                // ä¿å­˜åˆ°å†å²è®°å½•
                const historyItem = {
                    mode: selectedModeId,
                    time: timeString,
                    timestamp: now.getTime(),
                    lang: currentLang
                };
                
                drawHistory.unshift(historyItem);
                // åªä¿ç•™æœ€è¿‘20æ¡è®°å½•
                if (drawHistory.length > 20) {
                    drawHistory = drawHistory.slice(0, 20);
                }
                
                // ä¿å­˜åˆ°localStorage
                localStorage.setItem('warThunderDrawHistory', JSON.stringify(drawHistory));
                
                // æ›´æ–°å†å²è®°å½•æ˜¾ç¤º
                updateHistoryDisplay();
            });
            
            // å…¨é€‰æŒ‰é’®äº‹ä»¶
            selectAllButton.addEventListener('click', function() {
                for (const id in modes) {
                    document.getElementById(id).checked = true;
                }
            });
            
            // å…¨ä¸é€‰æŒ‰é’®äº‹ä»¶
            selectNoneButton.addEventListener('click', function() {
                for (const id in modes) {
                    document.getElementById(id).checked = false;
                }
            });
            
            // æ›´æ–°å†å²è®°å½•æ˜¾ç¤º
            function updateHistoryDisplay() {
                historyListElement.innerHTML = '';
                
                if (drawHistory.length === 0) {
                    historyListElement.innerHTML = `<div class="history-item">${translations[currentLang]['no-history']}</div>`;
                    return;
                }
                
                drawHistory.forEach(item => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    
                    const modeName = modes[item.mode] ? modes[item.mode][currentLang] : item.mode;
                    
                    historyItem.innerHTML = `
                        <span class="history-mode">${modeName}</span>
                        <span class="history-time">${item.time}</span>
                    `;
                    historyListElement.appendChild(historyItem);
                });
            }
        });
    </script>
</body>
</html>